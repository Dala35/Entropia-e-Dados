<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocolo de Expansão - Entropia & Dados v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .entropy-bg { 
            background: radial-gradient(circle at 20% 30%, rgba(16, 185, 129, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(6, 182, 212, 0.08) 0%, transparent 50%);
        }
        .scanline {
            width: 100%;
            height: 2px;
            background: rgba(16, 185, 129, 0.1);
            position: absolute;
            animation: scan 4s linear infinite;
            z-index: 10;
            pointer-events: none;
        }
        @keyframes scan {
            from { top: -2%; }
            to { top: 102%; }
        }
        .data-stream {
            mask-image: linear-gradient(to bottom, transparent, black, transparent);
        }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(16, 185, 129, 0.3); border-radius: 10px; }
    </style>
</head>
<body class="entropy-bg">
    <div class="scanline"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- CONSTANTS ---
        const APP_ID = "ENTROPIA-PROTO-01";

        // --- AUDIO ENGINE ---
        const useAudioEngine = () => {
            const audioCtx = useRef(null);
            const oscillator = useRef(null);
            const gainNode = useRef(null);

            const initAudio = () => {
                if (!audioCtx.current) {
                    audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                    oscillator.current = audioCtx.current.createOscillator();
                    gainNode.current = audioCtx.current.createGain();
                    oscillator.current.type = 'sine';
                    oscillator.current.connect(gainNode.current);
                    gainNode.current.connect(audioCtx.current.destination);
                    gainNode.current.gain.value = 0;
                    oscillator.current.start();
                }
            };

            const updateFreq = (entropy) => {
                if (!audioCtx.current || !oscillator.current) return;
                const freq = 100 + (entropy * 50);
                oscillator.current.frequency.setTargetAtTime(freq, audioCtx.current.currentTime, 0.1);
                gainNode.current.gain.setTargetAtTime(0.05, audioCtx.current.currentTime, 0.1);
            };

            const mute = () => {
                if (gainNode.current && audioCtx.current) {
                    gainNode.current.gain.setTargetAtTime(0, audioCtx.current.currentTime, 0.1);
                }
            };

            return { initAudio, updateFreq, mute };
        };

        function App() {
            const [dataInput, setDataInput] = useState("AFROKODICA");
            const [metrics, setMetrics] = useState({ entropy: 0, redundancy: 0, efficiency: 0 });
            const [isActive, setIsActive] = useState(false);
            const canvasRef = useRef(null);
            const { initAudio, updateFreq, mute } = useAudioEngine();

            // Cálculo Avançado de Métricas
            useEffect(() => {
                if (!dataInput || dataInput.trim() === "") {
                    setMetrics({ entropy: 0, redundancy: 0, efficiency: 0 });
                    mute();
                    return;
                }
                
                const freq = {};
                for (let char of dataInput) freq[char] = (freq[char] || 0) + 1;
                const len = dataInput.length;
                let entropy = 0;
                
                for (let char in freq) {
                    let p = freq[char] / len;
                    entropy -= p * Math.log2(p);
                }

                const maxPossibleEntropy = Math.log2(Math.min(len, 256) || 1);
                const redundancy = maxPossibleEntropy > 0 ? (1 - (entropy / maxPossibleEntropy)) * 100 : 0;
                const efficiency = (entropy / 8) * 100; 

                setMetrics({ 
                    entropy: entropy.toFixed(4), 
                    redundancy: Math.max(0, redundancy).toFixed(2),
                    efficiency: Math.min(100, efficiency).toFixed(2)
                });

                if (isActive) updateFreq(parseFloat(entropy));
            }, [dataInput, isActive]);

            // Sistema de Partículas
            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                let animationId;
                let particles = [];

                const resize = () => {
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                };
                window.addEventListener('resize', resize);
                resize();

                class Particle {
                    constructor() {
                        this.reset();
                    }
                    reset() {
                        this.x = Math.random() * canvas.width;
                        this.y = Math.random() * canvas.height;
                        this.vx = (Math.random() - 0.5) * 1;
                        this.vy = (Math.random() - 0.5) * 1;
                        this.history = [];
                    }
                    update(entropyVal) {
                        const entropy = parseFloat(entropyVal) || 0;
                        const force = entropy * 0.5;
                        this.vx += (Math.random() - 0.5) * force;
                        this.vy += (Math.random() - 0.5) * force;
                        
                        this.vx *= 0.98;
                        this.vy *= 0.98;

                        this.x += this.vx;
                        this.y += this.vy;

                        if(this.x < 0) this.x = canvas.width;
                        if(this.x > canvas.width) this.x = 0;
                        if(this.y < 0) this.y = canvas.height;
                        if(this.y > canvas.height) this.y = 0;

                        this.history.push({x: this.x, y: this.y});
                        if(this.history.length > 5) this.history.shift();
                    }
                    draw() {
                        ctx.beginPath();
                        ctx.strokeStyle = `rgba(16, 185, 129, 0.15)`;
                        this.history.forEach((h, i) => {
                            if(i===0) ctx.moveTo(h.x, h.y);
                            else ctx.lineTo(h.x, h.y);
                        });
                        ctx.stroke();

                        ctx.fillStyle = '#10b981';
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, 1.2, 0, Math.PI*2);
                        ctx.fill();
                    }
                }

                for(let i=0; i<120; i++) particles.push(new Particle());

                const animate = () => {
                    ctx.fillStyle = 'rgba(2, 6, 23, 0.15)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    particles.forEach(p => {
                        p.update(metrics.entropy);
                        p.draw();
                    });

                    // Ordem Emergente em baixa entropia
                    if (parseFloat(metrics.entropy) < 1.5) {
                        ctx.beginPath();
                        ctx.strokeStyle = 'rgba(6, 182, 212, 0.1)';
                        for(let i=0; i<particles.length; i+=2) {
                            for(let j=i+1; j<particles.length; j+=20) {
                                const dx = particles[i].x - particles[j].x;
                                const dy = particles[i].y - particles[j].y;
                                const dist = dx*dx + dy*dy;
                                if(dist < 2500) {
                                    ctx.moveTo(particles[i].x, particles[i].y);
                                    ctx.lineTo(particles[j].x, particles[j].y);
                                }
                            }
                        }
                        ctx.stroke();
                    }

                    animationId = requestAnimationFrame(animate);
                };

                animate();
                return () => {
                    cancelAnimationFrame(animationId);
                    window.removeEventListener('resize', resize);
                };
            }, [metrics.entropy]);

            return (
                <div className="h-screen w-full flex flex-col p-4 md:p-6 overflow-hidden">
                    {/* Header */}
                    <div className="flex justify-between items-start mb-6 z-20">
                        <div className="flex gap-4 items-center">
                            <div className="w-10 h-10 border border-emerald-500/50 flex items-center justify-center rounded-sm">
                                <div className="w-6 h-6 bg-emerald-500/10 animate-pulse flex items-center justify-center text-emerald-500 text-xs font-bold">
                                    Σ
                                </div>
                            </div>
                            <div>
                                <h1 className="text-lg font-black tracking-widest text-white uppercase italic">Entropy_Expander</h1>
                                <div className="flex gap-2 mt-0.5">
                                    <span className="text-[9px] bg-emerald-500 text-black px-1 font-bold">LIVE_STREAM</span>
                                    <span className="text-[9px] border border-white/20 px-1 text-white/50 font-mono italic">{APP_ID}</span>
                                </div>
                            </div>
                        </div>
                        
                        <button 
                            onClick={() => { initAudio(); setIsActive(!isActive); if(isActive) mute(); }}
                            className={`px-4 py-1.5 border font-mono text-[10px] tracking-tighter transition-all ${isActive ? 'bg-emerald-500 text-black border-emerald-500' : 'text-emerald-500 border-emerald-500/50 hover:bg-emerald-500/10'}`}
                        >
                            {isActive ? '[ SONAR: ONLINE ]' : '[ ATIVAR RESSONÂNCIA ]'}
                        </button>
                    </div>

                    <div className="flex-1 grid grid-cols-12 gap-4 min-h-0">
                        
                        {/* Metrics Panel */}
                        <div className="col-span-12 lg:col-span-3 flex flex-col gap-4 min-h-0">
                            <div className="bg-slate-900/40 border border-white/5 p-4 rounded-lg">
                                <label className="text-[9px] font-mono text-slate-500 uppercase block mb-2 tracking-widest">Input Data Array</label>
                                <textarea 
                                    value={dataInput}
                                    onChange={(e) => setDataInput(e.target.value)}
                                    className="w-full h-24 bg-black/50 border border-white/10 p-3 font-mono text-xs text-emerald-400 focus:border-emerald-500 outline-none resize-none custom-scrollbar"
                                />
                            </div>

                            <div className="flex-1 bg-slate-900/40 border border-white/5 p-4 rounded-lg flex flex-col justify-between">
                                <div className="space-y-5">
                                    <MetricBar label="Shannon Entropy (H)" value={metrics.entropy} color="bg-emerald-500" percent={(parseFloat(metrics.entropy)/8)*100} />
                                    <MetricBar label="Redundancy Index" value={metrics.redundancy + "%"} color="bg-cyan-500" percent={parseFloat(metrics.redundancy)} />
                                    <MetricBar label="Info Density" value={metrics.efficiency + "%"} color="bg-purple-500" percent={parseFloat(metrics.efficiency)} />
                                </div>

                                <div className="mt-4 pt-4 border-t border-white/5">
                                    <div className="flex items-center gap-2 mb-2">
                                        <div className="w-1 h-1 bg-emerald-500"></div>
                                        <span className="text-[9px] font-mono text-emerald-500 uppercase">Filosofia do Caos</span>
                                    </div>
                                    <p className="text-[10px] font-mono text-slate-500 leading-tight italic">
                                        "Onde a desordem cresce, a possibilidade de consciência se expande."
                                    </p>
                                </div>
                            </div>
                        </div>

                        {/* Visualization Matrix */}
                        <div className="col-span-12 lg:col-span-6 bg-black/40 border border-white/5 rounded-lg relative overflow-hidden group">
                            <canvas ref={canvasRef} className="w-full h-full" />
                            <div className="absolute top-3 left-3 font-mono text-[9px] text-emerald-500/30 tracking-[0.3em]">
                                CORE_MATRIX_STABLE
                            </div>
                            <div className="absolute bottom-3 right-3 flex items-center gap-3">
                                <div className="text-right">
                                    <p className="text-[8px] font-mono text-slate-600 uppercase">Calculated Nodes</p>
                                    <p className="text-[10px] font-bold text-emerald-500 tracking-widest">120 ACTIVE</p>
                                </div>
                            </div>
                        </div>

                        {/* Logs & Concept */}
                        <div className="col-span-12 lg:col-span-3 flex flex-col gap-4 min-h-0">
                            <div className="bg-slate-900/40 border border-white/5 p-4 rounded-lg flex-1 flex flex-col overflow-hidden">
                                <h3 className="text-[9px] font-mono text-emerald-500 uppercase mb-3 tracking-widest border-b border-emerald-500/10 pb-2">System_Log_01</h3>
                                <div className="flex-1 font-mono text-[9px] text-slate-500 space-y-1 overflow-y-auto data-stream custom-scrollbar">
                                    <p className="text-emerald-500/40">> Booting expansion module...</p>
                                    <p className="">> Analyzing {dataInput.length} symbols</p>
                                    <p className="">> H-Value: {metrics.entropy}</p>
                                    <p className="">> Audio Feedback: {isActive ? 'ON' : 'OFF'}</p>
                                    <p className="">> Syncing with Ma'at OS...</p>
                                    <p className="animate-pulse">> Waiting for data injection...</p>
                                </div>
                            </div>

                            <div className="bg-emerald-500/5 border border-emerald-500/10 p-4 rounded-lg">
                                <h4 className="text-[10px] font-bold text-emerald-400 mb-2 font-mono uppercase tracking-widest">Conceito Afrokódico</h4>
                                <p className="text-[10px] text-slate-400 leading-relaxed font-light">
                                    Em **Ifá**, o caos é o início da revelação. A entropia não é perda de energia, mas a transição para uma nova forma de ordem que o ego ainda não compreende.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    {/* Status Bar */}
                    <div className="mt-4 flex justify-between items-center text-[9px] font-mono text-slate-600 border-t border-white/5 pt-3">
                        <div className="flex gap-4">
                            <span className="text-emerald-500/50">8.83° S / 13.28° E</span>
                            <span className="hidden md:inline">SYSTEM: STABLE_V2.0.1</span>
                        </div>
                        <div className="flex gap-2 items-center">
                            <span className="uppercase tracking-widest">Afrokódica_Expansion_Network</span>
                            <div className="w-1.5 h-1.5 bg-emerald-500 rounded-full shadow-[0_0_5px_rgba(16,185,129,0.5)]"></div>
                        </div>
                    </div>
                </div>
            );
        }

        const MetricBar = ({ label, value, color, percent }) => (
            <div>
                <div className="flex justify-between text-[9px] font-mono mb-1.5 tracking-tighter uppercase">
                    <span className="text-slate-500">{label}</span>
                    <span className="text-white font-bold">{value}</span>
                </div>
                <div className="h-1 bg-black rounded-full overflow-hidden">
                    <div className={`h-full ${color} transition-all duration-700 ease-out`} style={{width: `${percent}%`}}></div>
                </div>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
